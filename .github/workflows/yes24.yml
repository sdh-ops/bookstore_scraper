name: YES24 Scraper

on:
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install system deps
        run: |
          sudo apt-get update
          name: YES24 Scraper

          on:
            workflow_dispatch:

          jobs:
            run:
              runs-on: ubuntu-latest
              timeout-minutes: 120
              steps:
                - name: Checkout
                  uses: actions/checkout@v4

                - name: Setup Python
                  uses: actions/setup-python@v5
                  with:
                    python-version: '3.11'

                - name: Install requirements
                  run: |
                    python -m pip install --upgrade pip
                    pip install -r requirements.txt

                - name: Run scraper (no tunnel)
                  env:
                    HEADLESS: '1'
                    YES24_ID: ${{ secrets.YES24_ID }}
                    YES24_PASSWORD: ${{ secrets.YES24_PASSWORD }}
                    GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
                  run: |
                    python main.py || true

                - name: Run integrated table generator
                  if: success()
                  env:
                    GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
                  run: |
                    python create_integrated_table.py || true

                - name: Upload artifacts
                  if: always()
                  uses: actions/upload-artifact@v4
                  with:
                    name: yes24-outputs
                    path: |
                      downloads/**
                      *.xls*
                      *.xlsx
