name: ì„œì  íŒë§¤ ë°ì´í„° ìë™ ìˆ˜ì§‘ (êµë³´/ì•Œë¼ë”˜/ì˜í’)

on:
  schedule:
    - cron: '30 22 * * *'  # í•œêµ­ì‹œê°„ ì˜¤ì „ 5:30 (UTC 20:30)
  workflow_dispatch:

jobs:
  scrape-and-integrate:
    runs-on: ubuntu-latest
    
    steps:
    - name: ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
    
    - name: Python 3.11 ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: ì˜ì¡´ì„± ì„¤ì¹˜
      run: |
        pip install --upgrade pip
        pip install selenium webdriver-manager gspread google-auth pandas openpyxl xlrd pytz
    
    - name: Chrome ì„¤ì¹˜
      uses: browser-actions/setup-chrome@latest
    
    - name: ChromeDriver ì„¤ì¹˜
      uses: nanasess/setup-chromedriver@master
    
    - name: credentials.json ìƒì„±
      env:
        GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
      run: |
        echo "$GOOGLE_CREDENTIALS" > credentials.json
    
    - name: êµë³´ë¬¸ê³  ìŠ¤í¬ë˜í•‘
      env:
        KYOBO_ID: ${{ secrets.KYOBO_ID }}
        KYOBO_PASSWORD: ${{ secrets.KYOBO_PASSWORD }}
      run: |
        python kyobo_scraper.py
      continue-on-error: true
    
    - name: ì•Œë¼ë”˜ ìŠ¤í¬ë˜í•‘
      env:
        ALADIN_ID: ${{ secrets.ALADIN_ID }}
        ALADIN_PASSWORD: ${{ secrets.ALADIN_PASSWORD }}
      run: |
        python aladin_scraper.py
      continue-on-error: true
    
    - name: ì˜í’ë¬¸ê³  ìŠ¤í¬ë˜í•‘
      env:
        YOUNGPOONG_ID: ${{ secrets.YOUNGPOONG_ID }}
        YOUNGPOONG_PASSWORD: ${{ secrets.YOUNGPOONG_PASSWORD }}
      run: |
        python youngpoong_scraper.py
      continue-on-error: true
    
    - name: í†µí•©í…Œì´ë¸” ìƒì„±
      run: |
        python create_integrated_table.py
    
    - name: ê²°ê³¼ ì•Œë¦¼
      if: always()
      run: |
        echo "âœ… ì„œì  íŒë§¤ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ (êµë³´/ì•Œë¼ë”˜/ì˜í’)"
        echo "â° ì‹¤í–‰ ì‹œê°„ (KST): $(TZ=Asia/Seoul date '+%Y-%m-%d %H:%M:%S')"
        echo "ğŸ“Œ YES24ëŠ” SMS ì¸ì¦ì´ í•„ìš”í•˜ì—¬ Base44 UIì—ì„œ ìˆ˜ë™ ì‹¤í–‰ë©ë‹ˆë‹¤."
