name: ì„œì  íŒë§¤ ë°ì´í„° ìë™ ìˆ˜ì§‘ (êµë³´/ì•Œë¼ë”˜/ì˜í’)

on:
  schedule:
    - cron: '30 20 * * *'  # UTC 20:30 -> KST 05:30
  workflow_dispatch:

jobs:
  scrape-and-integrate:
    runs-on: ubuntu-latest
    steps:
      - name: ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: Python 3.11 ì„¤ì •
        name: ì„œì  íŒë§¤ ë°ì´í„° ìë™ ìˆ˜ì§‘ (êµë³´/ì•Œë¼ë”˜/ì˜í’)

        on:
          schedule:
            - cron: '30 20 * * *'  # UTC 20:30 -> KST 05:30
          workflow_dispatch:

        jobs:
          scrape-and-integrate:
            runs-on: ubuntu-latest
            steps:
              - name: Checkout
                uses: actions/checkout@v4

              - name: Setup Python
                uses: actions/setup-python@v4
                with:
                  python-version: '3.11'

              - name: Install dependencies
                run: |
                  python -m pip install --upgrade pip
                  pip install selenium webdriver-manager gspread google-auth pandas openpyxl xlrd pytz

              - name: Create credentials.json
                env:
                  GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
                run: |
                  echo "$GOOGLE_CREDENTIALS" > credentials.json

              - name: Kyobo scraping
                env:
                  KYOBO_ID: ${{ secrets.KYOBO_ID }}
                  KYOBO_PASSWORD: ${{ secrets.KYOBO_PASSWORD }}
                run: |
                  python kyobo_scraper.py
                continue-on-error: true

              - name: Aladin scraping
                env:
                  ALADIN_ID: ${{ secrets.ALADIN_ID }}
                  ALADIN_PASSWORD: ${{ secrets.ALADIN_PASSWORD }}
                run: |
                  python aladin_scraper.py
                continue-on-error: true

              - name: Youngpoong scraping
                env:
                  YOUNGPOONG_ID: ${{ secrets.YOUNGPOONG_ID }}
                  YOUNGPOONG_PASSWORD: ${{ secrets.YOUNGPOONG_PASSWORD }}
                run: |
                  python youngpoong_scraper.py
                continue-on-error: true

              - name: Create integrated table
                env:
                  GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
                run: |
                  python create_integrated_table.py

              - name: Notify
                if: always()
                run: |
                  echo "âœ… ì„œì  íŒë§¤ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ (êµë³´/ì•Œë¼ë”˜/ì˜í’)"
                  echo "â° ì‹¤í–‰ ì‹œê°„ (KST): $(TZ=Asia/Seoul date '+%Y-%m-%d %H:%M:%S')"
                  echo "ğŸ“Œ YES24ëŠ” SMS ì¸ì¦ì´ í•„ìš”í•˜ì—¬ Base44 UIì—ì„œ ìˆ˜ë™ ì‹¤í–‰ë©ë‹ˆë‹¤."

      on:
        schedule:
          - cron: '30 20 * * *'  # í•œêµ­ì‹œê°„ ì˜¤ì „ 5:30 (UTC 20:30)
        workflow_dispatch:

      jobs:
        scrape-and-integrate:
          runs-on: ubuntu-latest
    
          steps:
          - name: ì²´í¬ì•„ì›ƒ
            uses: actions/checkout@v4

          - name: Python 3.11 ì„¤ì •
            uses: actions/setup-python@v4
            with:
              python-version: '3.11'
              cache: 'pip'
    
          - name: ì˜ì¡´ì„± ì„¤ì¹˜
            run: |
              pip install --upgrade pip
              pip install selenium webdriver-manager gspread google-auth pandas openpyxl xlrd pytz
    
          - name: Chrome ì„¤ì¹˜
            name: ì„œì  íŒë§¤ ë°ì´í„° ìë™ ìˆ˜ì§‘ (êµë³´/ì•Œë¼ë”˜/ì˜í’)

            on:
              schedule:
                - cron: '30 20 * * *'
              workflow_dispatch:

            jobs:
              scrape-and-integrate:
                runs-on: ubuntu-latest
                steps:
                  - name: Checkout
                    uses: actions/checkout@v4

                  - name: Setup Python
                    uses: actions/setup-python@v4
                    with:
                      python-version: '3.11'

                  - name: Install dependencies
                    run: |
                      python -m pip install --upgrade pip
                      pip install selenium webdriver-manager gspread google-auth pandas openpyxl xlrd pytz

                  - name: Create credentials.json
                    env:
                      GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
                    run: |
                      echo "$GOOGLE_CREDENTIALS" > credentials.json

                  - name: Kyobo
                    env:
                      KYOBO_ID: ${{ secrets.KYOBO_ID }}
                      KYOBO_PASSWORD: ${{ secrets.KYOBO_PASSWORD }}
                    run: |
                      python kyobo_scraper.py || true

                  - name: Aladin
                    env:
                      ALADIN_ID: ${{ secrets.ALADIN_ID }}
                      ALADIN_PASSWORD: ${{ secrets.ALADIN_PASSWORD }}
                    run: |
                      python aladin_scraper.py || true

                  - name: Youngpoong
                    env:
                      YOUNGPOONG_ID: ${{ secrets.YOUNGPOONG_ID }}
                      YOUNGPOONG_PASSWORD: ${{ secrets.YOUNGPOONG_PASSWORD }}
                    run: |
                      python youngpoong_scraper.py || true

                  - name: Generate integrated table
                    env:
                      GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
                    run: |
                      python create_integrated_table.py || true

                  - name: Upload artifacts
                    if: always()
                    uses: actions/upload-artifact@v4
                    with:
                      name: bookstore-outputs
                      path: |
                        downloads/**
                        *.xls*
                        *.xlsx
                      echo "âœ… ì„œì  íŒë§¤ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ (êµë³´/ì•Œë¼ë”˜/ì˜í’)"
                      echo "â° ì‹¤í–‰ ì‹œê°„ (KST): $(TZ=Asia/Seoul date '+%Y-%m-%d %H:%M:%S')"
                      echo "ğŸ“Œ YES24ëŠ” SMS ì¸ì¦ì´ í•„ìš”í•˜ì—¬ Base44 UIì—ì„œ ìˆ˜ë™ ì‹¤í–‰ë©ë‹ˆë‹¤."
